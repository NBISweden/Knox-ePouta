% \beginpgfgraphicnamed{overview}
\begin{tikzpicture}
  [vm/.append style={drop shadow}]  
  %\draw[help lines] (0,0) grid (3,2);

  \draw[rounded corners,thick]%
  (0,0) to[bend right=15]
  coordinate[pos=0]    (vm1-epouta)
  coordinate[pos=0.25] (vm2-epouta)
  coordinate[pos=0.5]  (vm3-epouta)
  coordinate[pos=0.75] (dhcp-epouta)
  ++(-1.5,-5) to
  node[pos=0.3,link] (link) {1 Gb/s}
  coordinate[pos=0.7] (router)
  coordinate[pos=0.87] (dhcp-knox)
  ++(6,0) to[bend right=15]
  coordinate[pos=0.01] (supernode)
  coordinate[pos=0.25] (storage)
  coordinate[pos=1]    (vm1-knox)
  coordinate[pos=0.75] (vm2-knox)
  coordinate[pos=0.5]  (vm3-knox)
  ++(0.5,5);

  \path[every pin/.style={vm},pin distance=2ex,every pin edge/.style={thick,bend right=10,auto}]
  % 
  (vm1-epouta)  node[connector,pin=left:{VM$_1$\nodepart{two}10.101.0.21}] {}
  (vm2-epouta)  node[connector,pin=left:{VM$_2$\nodepart{two}10.101.0.22}] {}
  (vm3-epouta)  node[connector,pin=left:{VM$_3$\nodepart{two}10.101.0.23}] {}
  (dhcp-epouta) node[connector,pin=left:{DHCP\nodepart{two}10.101.0.3}] {}
  (router)      node[connector,pin=above:{Router\nodepart{two}10.101.0.1}] {}
  (dhcp-knox)   node[connector,pin=below:{DHCP\nodepart{two}10.101.128.0}] {}
  (supernode)   node[connector,pin=right:{Supernode\nodepart{two}10.101.128.100}] {}
  (storage)     node[connector,pin=right:{Storage\nodepart{two}10.101.128.104}] {}
  (vm1-knox)    node[connector,pin=right:{VM$_1$\nodepart{two}10.101.128.101}] {}
  (vm2-knox)    node[connector,pin=right:{VM$_2$\nodepart{two}10.101.128.102}] {}
  (vm3-knox)    node[connector,pin=right:{VM$_3$\nodepart{two}10.101.128.103}] {}
  ;


  \path[name path=border] (link) -- ++(60:65mm) node[above left=3ex,pos=0.6](fin){Finland} node[below right=3ex,pos=0.6](swe){Sweden};
  \path [name path=limit] (vm1-epouta) -- (vm1-knox);
  \path [name intersections={of=border and limit, by=x},] (link) -- (x);
  
  \path (link.center) ++(left:3cm) coordinate(link');
  \path (link.center) ++(right:7cm) coordinate(link'');
  \path (x) ++(left:6cm) coordinate(x');
  \path (x) ++(right:4cm) coordinate(x'');
  
  \begin{pgfonlayer}{my background}
    \clip (-3,0) rectangle +(9,-5);

    \shade[right color=blue!20,left color=white,decorate,decoration={snake,segment length=6ex, amplitude=0.5ex}]%
    (link.center) -- (x) -- (x') -- (link') -- cycle;

    \shade[left color=yellow!50,right color=white,decorate,decoration={snake,segment length=6ex, amplitude=0.5ex}]%
    (link.center) -- (x) -- (x'') -- (link'') -- cycle;
  \end{pgfonlayer}

\end{tikzpicture}
% \endpgfgraphicnamed
